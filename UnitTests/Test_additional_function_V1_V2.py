import unittest
import numpy
from Functions.validation import *
from Functions.Update_template import *

class Test_get_latest_version_of_template_file(unittest.TestCase):
    def setUp(self):

        self.variable = {
            'S3BucketName': "444235434904-pvcam-s3-blackbox-template-store-prod",
            'TableName_IMU': 'dailyimu',
            'DataBase': 'dailyimureportdb',
            'S3BucketNameSaveQuery': 'aws-athena-query-results-us-east-1-444235434904'
        }

    def test_result_of_get_latest_version_of_template_file(self):

        Variables = self.variable
        new_version,old_version,new_version_file,old_version_file = get_latest_version_of_template_file(Variables['S3BucketName'])
        expected_new_version = 'v6'
        expected_old_version = 'v5'
        expected_new_version_file = 'templates_v6.zip'
        expected_old_version_file = 'templates_v5.zip'

        self.assertEqual(new_version, expected_new_version)
        self.assertEqual(old_version, expected_old_version)
        self.assertEqual(new_version_file, expected_new_version_file)
        self.assertEqual(old_version_file, expected_old_version_file)


class Test_matching_score_dict_with_current_templates_file(unittest.TestCase):
    def setUp(self):
        self.variable = {
            'S3BucketName': "444235434904-pvcam-s3-blackbox-template-store-prod",
            'TableName_IMU': 'dailyimu',
            'DataBase': 'dailyimureportdb',
            'S3BucketNameSaveQuery': 'aws-athena-query-results-us-east-1-444235434904',
            'ZipFile':'templates_v5.zip'
        }

    def test_result_format_of_matching_score_dict_with_current_templates_file(self):
        Variables = self.variable
        templates_data = loadTemplatesFromS3(Variables['S3BucketName'], Variables['ZipFile'])[0]
        test_template_array = [[-0.0, -0.02, -0.03],
                                 [0.0, 0.01, -0.03],
                                 [0.0, 0.04, -0.04],
                                 [0.0, 0.03, -0.04],
                                 [0.0, 0.01, -0.03],
                                 [0.02, 0.02, -0.04],
                                 [0.0, 0.01, -0.03],
                                 [0.0, 0.03, -0.04],
                                 [0.0, 0.01, -0.03],
                                 [0.02, 0.01, -0.03],
                                 [0.0, 0.01, -0.05],
                                 [-0.22, 0.03, -0.02],
                                 [-0.25, 0.05, -0.03],
                                 [-0.23, 0.03, -0.04],
                                 [-0.22, -0.0, -0.02],
                                 [-0.24, -0.02, -0.03],
                                 [-0.28, 0.02, -0.02],
                                 [-0.23, 0.06, -0.04],
                                 [-0.23, 0.01, -0.04],
                                 [-0.3, -0.0, -0.05],
                                 [-0.3, -0.07, -0.05],
                                 [-0.33, -0.02, -0.05],
                                 [-0.3, -0.1, -0.06],
                                 [-0.34, -0.11, -0.06],
                                 [-0.21, -0.1, -0.05],
                                 [-0.01, -0.09, 0.0],
                                 [-0.02, -0.05, -0.18],
                                 [0.02, -0.08, 0.08],
                                 [-0.02, -0.02, -0.12],
                                 [-0.43, -0.08, 0.08],
                                 [-0.19, -0.07, -0.2],
                                 [-0.24, -0.08, 0.09],
                                 [-0.31, 0.04, -0.17],
                                 [-0.28, 0.07, 0.02],
                                 [-0.21, -0.11, -0.01],
                                 [-0.2, 0.03, -0.1],
                                 [-0.24, -0.05, 0.01],
                                 [-0.16, -0.03, -0.04],
                                 [-0.17, 0.09, 0.06],
                                 [-0.07, 0.15, -0.17],
                                 [-0.08, 0.21, 0.17],
                                 [-0.09, 0.29, 0.14],
                                 [0.02, 0.28, -0.22],
                                 [0.06, 0.23, -0.1],
                                 [0.33, 0.2, -0.02],
                                 [0.68, 0.04, -0.05],
                                 [0.82, 0.0, -0.11],
                                 [0.83, -0.02, -0.14],
                                 [0.78, -0.01, -0.09],
                                 [0.92, -0.08, -0.06],
                                 [0.91, -0.04, -0.02],
                                 [0.78, -0.11, -0.03],
                                 [1.01, -0.12, -0.06],
                                 [-0.16, 0.0, 0.03],
                                 [0.16, 0.01, -0.18],
                                 [-0.0, -0.0, 0.06],
                                 [0.03, -0.03, -0.04],
                                 [-0.0, -0.02, -0.11],
                                 [-0.0, -0.05, -0.02],
                                 [-0.0, -0.01, -0.05],
                                 [0.01, -0.01, -0.03],
                                 [-0.0, -0.02, -0.03],
                                 [0.02, 0.01, -0.11],
                                 [-0.0, -0.01, -0.05],
                                 [0.01, -0.01, -0.03],
                                 [-0.0, -0.01, -0.05],
                                 [-0.0, -0.04, -0.04],
                                 [-0.0, -0.04, -0.04],
                                 [0.0, 0.03, -0.04],
                                 [-0.02, -0.04, -0.04],
                                 [-0.22, -0.05, -0.01],
                                 [-0.18, 0.05, -0.04],
                                 [-0.14, -0.03, -0.03],
                                 [-0.25, 0.01, -0.02],
                                 [-0.17, 0.05, -0.04],
                                 [-0.17, 0.04, -0.04],
                                 [-0.19, 0.04, -0.01],
                                 [-0.2, 0.07, -0.05],
                                 [-0.15, 0.04, -0.02],
                                 [-0.14, 0.05, -0.03],
                                 [-0.11, 0.05, -0.01],
                                 [-0.11, 0.06, -0.04],
                                 [-0.1, 0.11, -0.04],
                                 [-0.07, 0.06, -0.04],
                                 [-0.06, 0.02, -0.11],
                                 [-0.01, 0.06, -0.01],
                                 [-0.01, 0.04, -0.07],
                                 [-0.01, 0.03, -0.02],
                                 [-0.0, -0.03, 0.02],
                                 [0.03, -0.02, -0.08],
                                 [0.01, -0.07, -0.05],
                                 [-0.0, -0.04, -0.04],
                                 [0.01, -0.09, 0.02],
                                 [-0.0, -0.05, -0.04]]
        score_list = matching_score_dict_with_current_templates_file(templates_data,test_template_array)
        result_format = type(score_list)
        expected_format = dict
        result_count = len(score_list)
        expected_count = 249
        self.assertEqual(result_format, expected_format)
        self.assertEqual(result_count, expected_count)

class Test_data_with_matching_score_list(unittest.TestCase):
    def setUp(self):
        self.variable = {
            'S3BucketName': "444235434904-pvcam-s3-blackbox-template-store-prod",
            'TableName_IMU': 'dailyimu',
            'DataBase': 'dailyimureportdb',
            'S3BucketNameSaveQuery': 'aws-athena-query-results-us-east-1-444235434904',
            'ZipFile':'templates_v5.zip'
        }

    def test_result_format_of_data_with_matching_score_list(self):
        Variables = self.variable
        templates_data = loadTemplatesFromS3(Variables['S3BucketName'], Variables['ZipFile'])[0]
        daily_imu_review_dict = [{'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}]
        daily_imu_review_dict_result = data_with_matching_score_list(daily_imu_review_dict, templates_data)

        result_format_of_data_with_matching_score_list = type(daily_imu_review_dict_result[0]['matching_score_list'])
        expect_format_of_data_with_matching_score_list = dict
        result_count_of_data_with_matching_score_list = len(daily_imu_review_dict_result[0]['matching_score_list'])
        expect_count_of_data_with_matching_score_list = 249

        self.assertEqual(result_format_of_data_with_matching_score_list, expect_format_of_data_with_matching_score_list)
        self.assertEqual(result_count_of_data_with_matching_score_list, expect_count_of_data_with_matching_score_list)

    def test_result_format_of_data_with_matching_score_list(self):
        Variables = self.variable
        templates_data = loadTemplatesFromS3(Variables['S3BucketName'], Variables['ZipFile'])[0]
        daily_imu_review_dict = [{'rawdata': None}]
        daily_imu_review_dict_result = data_with_matching_score_list(daily_imu_review_dict, templates_data)

        result_of_data_with_matching_score_list = daily_imu_review_dict_result[0]['matching_score_list']
        expect_of_data_with_matching_score_list = None

        self.assertEqual(result_of_data_with_matching_score_list, expect_of_data_with_matching_score_list)

class Test_divide_validation_events_by_classification(unittest.TestCase):
    def setUp(self):
        self.event_category = {'harshBraking': ['Braking','Harsh Braking'],
                                    'harshLeftTurn':['Left','Harsh Left Turn'],
                                    'harshRightTurn': ['Right','Harsh Right Turn'],
                                    'bump':['Bump','Non Event','Slow Speed Event'],
                                    'harshAcceleration':['Acceleration','Harsh Acceleration']}
        self.validation_events = [{'Correct Classification':'Left'},
                                  {'Correct Classification':'Harsh Right Turn'},
                                  {'Correct Classification':'Harsh'},
                                  {'Correct Classification':None}]

    def test_result_of_divide_validation_events_by_classification(self):
            event_category = self.event_category
            validation_events = self.validation_events
            Result = divide_validation_events_by_classification(validation_events,'left',event_category)
            print(Result)
            result_of_confirmed_data =Result[0][0]['Correct Classification']
            result_of_confirmed_other_data =Result[1][0]['Correct Classification']
            result_of_confirmed_class = Result[2]

            expect_of_confirmed_data = 'Left'
            expect_of_confirmed_other_data = 'Harsh Right Turn'
            expect_of_confirmed_class = 'harshLeftTurn'


            self.assertEqual(result_of_confirmed_data, expect_of_confirmed_data)
            self.assertEqual(result_of_confirmed_other_data, expect_of_confirmed_other_data)
            self.assertEqual(result_of_confirmed_class, expect_of_confirmed_class)

    def test_result_of_wrong_class_of_divide_validation_events_by_classification(self):# check if the correct classification is wrong, but still similiar to some category
            event_category = self.event_category
            validation_events = self.validation_events
            Result = divide_validation_events_by_classification(validation_events,'lef',event_category)
            print(Result)
            result_of_confirmed_data =Result[0][0]['Correct Classification']
            result_of_confirmed_other_data =Result[1][0]['Correct Classification']
            result_of_confirmed_class = Result[2]

            expect_of_confirmed_data = 'Left'
            expect_of_confirmed_other_data = 'Harsh Right Turn'
            expect_of_confirmed_class = 'harshLeftTurn'


            self.assertEqual(result_of_confirmed_data, expect_of_confirmed_data)
            self.assertEqual(result_of_confirmed_other_data, expect_of_confirmed_other_data)
            self.assertEqual(result_of_confirmed_class, expect_of_confirmed_class)

    def test_result_of_none_class_of_divide_validation_events_by_classification(self):# check if the correct classification is None
            event_category = self.event_category
            validation_events = self.validation_events
            result = divide_validation_events_by_classification(validation_events,None,event_category)
            expect = None
            self.assertEqual(result,expect)

class Test_score_of_one_template_with_one_event(unittest.TestCase):
    def setUp(self):
        self.template_data = {'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.one_event_data = {'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.second_event_data = {'rawdata':None}

    def test_result_format_of_one_template_with_one_event(self):

        result = type(score_of_one_template_with_one_event(self.template_data,self.one_event_data))
        expect = numpy.float64
        self.assertEqual(result, expect)

    def test_none_output_of_one_template_with_one_event(self):

        result = score_of_one_template_with_one_event(self.template_data,self.second_event_data)
        expect = None
        self.assertEqual(result, expect)

class Test_create_matching_score_list_with_potential_templates(unittest.TestCase):
    def setUp(self):
        self.template_data = {'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.one_event_data = {'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.second_event_data = {'rawdata':None}
        self.potential_template_key = 'harshLeftTurn'

    def test_result_format_of_create_matching_score_list_with_potential_templates(self):

        create_matching_score_list_with_potential_templates(self.one_event_data,self.template_data,self.potential_template_key)
        result_format = type(self.one_event_data['matching_score_list_with_potential_template'])
        expect_format = dict
        result_count = len(self.one_event_data['matching_score_list_with_potential_template'])
        expect_count = 1

        self.assertEqual(result_format, expect_format)
        self.assertEqual(result_count, expect_count)

    def test_empty_input_of_create_matching_score_list_with_potential_templates(self):

        create_matching_score_list_with_potential_templates(self.second_event_data,self.template_data,self.potential_template_key)
        result_format = type(self.second_event_data['matching_score_list_with_potential_template'])
        expect_format = dict
        result = [i[1] for i in self.second_event_data['matching_score_list_with_potential_template'].items()][0]
        expect = None

        self.assertEqual(result_format, expect_format)
        self.assertEqual(result, expect)

#mean_difference_value_every_event(event: dict,potential_event:dict,new_comfirmed_class:str,potential_template_key:str)
class Test_mean_difference_value_every_event(unittest.TestCase):
    def setUp(self):
        self.event = {'matching_score_list':{'harshBraking_1':1,
                                             'harshBraking_2':3,
                                             'harshRightTurn_3':2,
                                             'harshRightTurn_4':2,},
                      'matching_score_list_with_potential_template':{'harshBraking_3':1,
                                                                     'harshBraking_4':3,
                                                                     'harshRightTurn_5':2,
                                                                     'harshRightTurn_6':2,},
                      'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.potential_event = {'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.potential_second_event= {'rawdata':None}
        self.potential_template_key = 'harshRightTurn_25'
        self.new_comfirmed_class = 'harshRightTurn'

    def test_mean_difference_value_every_event(self):

        result = mean_difference_value_every_event(self.event,self.potential_event,self.new_comfirmed_class,self.potential_template_key)
        result_format = type(result)
        expect_format = numpy.float64
        print(result)


        self.assertEqual(result_format, expect_format)

    def test_empty_input_of_create_matching_score_list_with_potential_templates(self):

        result = mean_difference_value_every_event(self.event,self.potential_second_event,self.new_comfirmed_class,self.potential_template_key)
        expect = 0

        self.assertEqual(result, expect)

class Test_top3_result_of_one_event(unittest.TestCase):
    def setUp(self):
        self.event = {'matching_score_list':{'harshBraking_1':1,
                                             'harshBraking_2':3,
                                             'harshRightTurn_3':2,
                                             'harshRightTurn_4':2,},
                      'matching_score_list_with_potential_template':{'harshBraking_3':1,
                                                                     'harshBraking_4':28,
                                                                     'harshRightTurn_5':2,
                                                                     'harshRightTurn_6':0.5,},
                      'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.potential_event = {'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.potential_second_event= {'rawdata':None}
        self.potential_template_key = 'harshRightTurn_25'
        self.new_comfirmed_class = 'harshRightTurn'

    def test_top3_result_of_one_event(self):

        result = top3_result_of_one_event('harshRightTurn_6',self.event)[0]
        expect = 'existed_in_top_3'
        self.assertEqual(result, expect)

    def test_top3_result_of_one_event2(self):
        result =len(top3_result_of_one_event('harshBraking_4', self.event))
        expect = 0
        self.assertEqual(result, expect)


class Test_add_template_performance_of_v1(unittest.TestCase):
    def setUp(self):
        self.potential_event = {
            'rawdata': '{"MetaData": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "vehicleId": "00da6d11-e01e-4530-a314-ed552333f72a", "physicalId": "fa2a4954-5ce9-4a19-b327-95978a0285f5", "nodeId": "6885fa55-9941-4104-bab6-ab7e92501d08", "orgId": "7677c7f9-b54f-4cca-b0dc-63a2253bd000", "timeStamp": "2022-11-29T19:44:33Z", "id": "1f603417-07f1-42fd-a596-cf7fde645eb6", "lat": "53.412983", "lng": "-1.403371"}, "Instances": {"features": {"deviceId": "ec639c1e-cedc-492b-96fc-018da2e4bbf5", "event_time": "2022-11-29T19:44:33Z", "start_time": "2022-11-29 19:44:23.009000", "end_time": "2022-11-29 19:44:42.999000", "trigger": [0.5, 0.4, 2.5], "deviceType": "0", "featurevector": [["2022-11-29 19:44:23.009000+00:00", "-0.17", "0.27", "-0.06"], ["2022-11-29 19:44:23.199000+00:00", "-0.18", "0.29", "-0.07"], ["2022-11-29 19:44:23.399000+00:00", "-0.18", "0.3", "-0.05"], ["2022-11-29 19:44:23.600000+00:00", "-0.21", "0.28", "-0.02"], ["2022-11-29 19:44:23.799000+00:00", "-0.19", "0.22", "-0.07"], ["2022-11-29 19:44:23.999000+00:00", "-0.11", "0.11", "0.0"], ["2022-11-29 19:44:24.200000+00:00", "-0.05", "0.04", "0.07"], ["2022-11-29 19:44:24.399000+00:00", "-0.08", "0.03", "0.01"], ["2022-11-29 19:44:24.599000+00:00", "-0.06", "0.08", "-0.04"], ["2022-11-29 19:44:24.799000+00:00", "-0.02", "0.1", "-0.05"], ["2022-11-29 19:44:24.999000+00:00", "-0.08", "0.14", "0.0"], ["2022-11-29 19:44:25.200000+00:00", "-0.1", "0.1", "0.04"], ["2022-11-29 19:44:25.400000+00:00", "-0.15", "0.16", "-0.04"], ["2022-11-29 19:44:25.599000+00:00", "-0.22", "0.24", "-0.04"], ["2022-11-29 19:44:25.799000+00:00", "-0.22", "0.2", "0.01"], ["2022-11-29 19:44:25.999000+00:00", "-0.14", "0.2", "-0.02"], ["2022-11-29 19:44:26.200000+00:00", "-0.18", "0.19", "0.03"], ["2022-11-29 19:44:26.400000+00:00", "-0.07", "0.2", "0.02"], ["2022-11-29 19:44:26.599000+00:00", "-0.13", "0.14", "-0.05"], ["2022-11-29 19:44:26.799000+00:00", "-0.05", "0.17", "-0.0"], ["2022-11-29 19:44:27+00:00", "-0.02", "0.22", "-0.04"], ["2022-11-29 19:44:27.200000+00:00", "-0.02", "0.25", "-0.05"], ["2022-11-29 19:44:27.400000+00:00", "0.02", "0.26", "0.04"], ["2022-11-29 19:44:27.600000+00:00", "0.07", "0.3", "0.02"], ["2022-11-29 19:44:27.800000+00:00", "0.06", "0.32", "-0.12"], ["2022-11-29 19:44:28+00:00", "0.21", "0.26", "-0.01"], ["2022-11-29 19:44:28.199000+00:00", "0.21", "0.18", "0.0"], ["2022-11-29 19:44:28.399000+00:00", "0.14", "0.19", "-0.01"], ["2022-11-29 19:44:28.600000+00:00", "0.24", "0.28", "-0.01"], ["2022-11-29 19:44:28.799000+00:00", "0.06", "0.18", "-0.13"], ["2022-11-29 19:44:28.999000+00:00", "0.17", "0.3", "0.14"], ["2022-11-29 19:44:29.199000+00:00", "0.18", "0.29", "-0.05"], ["2022-11-29 19:44:29.399000+00:00", "0.15", "0.32", "-0.08"], ["2022-11-29 19:44:29.599000+00:00", "0.14", "0.33", "-0.08"], ["2022-11-29 19:44:29.799000+00:00", "0.17", "0.3", "-0.0"], ["2022-11-29 19:44:30+00:00", "0.19", "0.12", "0.1"], ["2022-11-29 19:44:30.199000+00:00", "0.1", "0.28", "-0.12"], ["2022-11-29 19:44:30.399000+00:00", "0.17", "0.37", "-0.08"], ["2022-11-29 19:44:30.600000+00:00", "0.2", "0.14", "0.11"], ["2022-11-29 19:44:30.799000+00:00", "0.3", "0.26", "0.0"], ["2022-11-29 19:44:30.999000+00:00", "0.18", "0.33", "-0.28"], ["2022-11-29 19:44:31.200000+00:00", "0.22", "0.32", "0.03"], ["2022-11-29 19:44:31.399000+00:00", "0.2", "0.34", "-0.05"], ["2022-11-29 19:44:31.600000+00:00", "0.26", "0.29", "-0.08"], ["2022-11-29 19:44:31.800000+00:00", "0.17", "0.24", "0.12"], ["2022-11-29 19:44:32+00:00", "0.15", "0.29", "-0.1"], ["2022-11-29 19:44:32.200000+00:00", "0.15", "0.37", "-0.05"], ["2022-11-29 19:44:32.399000+00:00", "0.21", "0.22", "0.02"], ["2022-11-29 19:44:32.599000+00:00", "0.36", "0.41", "-0.1"], ["2022-11-29 19:44:32.800000+00:00", "0.42", "0.49", "-0.03"], ["2022-11-29 19:44:33+00:00", "0.26", "0.35", "-0.02"], ["2022-11-29 19:44:33.199000+00:00", "0.24", "0.35", "0.02"], ["2022-11-29 19:44:33.400000+00:00", "0.27", "0.38", "0.18"], ["2022-11-29 19:44:33.600000+00:00", "0.14", "0.32", "-0.34"], ["2022-11-29 19:44:33.799000+00:00", "0.38", "0.38", "0.17"], ["2022-11-29 19:44:34+00:00", "0.28", "0.35", "-0.06"], ["2022-11-29 19:44:34.199000+00:00", "0.17", "0.25", "-0.18"], ["2022-11-29 19:44:34.400000+00:00", "0.26", "0.35", "0.04"], ["2022-11-29 19:44:34.599000+00:00", "0.2", "0.31", "-0.06"], ["2022-11-29 19:44:34.800000+00:00", "0.05", "0.14", "0.04"], ["2022-11-29 19:44:35+00:00", "0.04", "0.22", "-0.12"], ["2022-11-29 19:44:35.200000+00:00", "0.15", "0.31", "-0.06"], ["2022-11-29 19:44:35.399000+00:00", "0.13", "0.35", "0.03"], ["2022-11-29 19:44:35.599000+00:00", "0.01", "0.26", "-0.2"], ["2022-11-29 19:44:35.799000+00:00", "-0.08", "0.2", "-0.04"], ["2022-11-29 19:44:36+00:00", "-0.02", "0.28", "0.25"], ["2022-11-29 19:44:36.200000+00:00", "0.05", "0.34", "-0.17"], ["2022-11-29 19:44:36.399000+00:00", "-0.07", "0.22", "-0.17"], ["2022-11-29 19:44:36.600000+00:00", "-0.13", "0.22", "-0.08"], ["2022-11-29 19:44:36.799000+00:00", "-0.03", "0.21", "0.11"], ["2022-11-29 19:44:37+00:00", "-0.06", "0.31", "-0.08"], ["2022-11-29 19:44:37.200000+00:00", "-0.1", "0.22", "-0.04"], ["2022-11-29 19:44:37.399000+00:00", "-0.06", "0.21", "0.07"], ["2022-11-29 19:44:37.605000+00:00", "-0.05", "0.28", "-0.04"], ["2022-11-29 19:44:37.804000+00:00", "-0.08", "0.26", "-0.04"], ["2022-11-29 19:44:38+00:00", "-0.08", "0.23", "0.02"], ["2022-11-29 19:44:38.199000+00:00", "-0.08", "0.2", "-0.03"], ["2022-11-29 19:44:38.400000+00:00", "-0.1", "0.21", "-0.06"], ["2022-11-29 19:44:38.599000+00:00", "-0.14", "0.21", "-0.04"], ["2022-11-29 19:44:38.800000+00:00", "-0.16", "0.17", "-0.1"], ["2022-11-29 19:44:39+00:00", "-0.07", "0.14", "-0.01"], ["2022-11-29 19:44:39.200000+00:00", "-0.03", "0.16", "-0.1"], ["2022-11-29 19:44:39.399000+00:00", "-0.03", "0.14", "-0.02"], ["2022-11-29 19:44:39.599000+00:00", "-0.05", "0.06", "0.1"], ["2022-11-29 19:44:39.799000+00:00", "-0.05", "0.07", "-0.1"], ["2022-11-29 19:44:40+00:00", "0.0", "0.05", "0.03"], ["2022-11-29 19:44:40.200000+00:00", "-0.0", "0.14", "-0.03"], ["2022-11-29 19:44:40.400000+00:00", "0.05", "0.06", "0.03"], ["2022-11-29 19:44:40.599000+00:00", "0.01", "0.05", "-0.01"], ["2022-11-29 19:44:40.799000+00:00", "0.03", "0.03", "0.02"], ["2022-11-29 19:44:41+00:00", "0.01", "0.02", "-0.07"], ["2022-11-29 19:44:41.199000+00:00", "-0.13", "-0.08", "-0.07"], ["2022-11-29 19:44:41.400000+00:00", "-0.1", "-0.02", "-0.09"], ["2022-11-29 19:44:41.599000+00:00", "0.02", "-0.03", "0.01"], ["2022-11-29 19:44:41.800000+00:00", "0.02", "0.05", "-0.23"], ["2022-11-29 19:44:42+00:00", "0.01", "-0.01", "-0.03"], ["2022-11-29 19:44:42.200000+00:00", "0.04", "-0.02", "0.04"], ["2022-11-29 19:44:42.399000+00:00", "0.04", "-0.03", "0.03"], ["2022-11-29 19:44:42.600000+00:00", "0.01", "-0.01", "0.05"], ["2022-11-29 19:44:42.799000+00:00", "0.02", "0.11", "0.01"], ["2022-11-29 19:44:42.999000+00:00", "-0.04", "0.13", "-0.19"]], "EnergyX": 2.3344000000000014, "EnergyY": 5.735499999999997, "EnergyZ": 0.8755000000000004, "MeanDiffX": -5.551115123125783e-17, "MeanDiffY": 7.0360384185619296e-15, "MeanDiffZ": -2.7755575615628914e-17, "DifferenceX": 2.3344000000000014, "DifferenceY": 5.735499999999997, "DifferenceZ": 0.8755000000000004, "HistogramX": [4, 5, 6, 5, 9, 12, 6, 10, 8, 1, 2, 7, 8, 7, 2, 5, 1, 0, 2, 1], "bin_edgesX": [-0.22, -0.188, -0.156, -0.124, -0.092, -0.06, -0.027999999999999997, 0.0040000000000000036, 0.036000000000000004, 0.06800000000000003, 0.1, 0.13199999999999998, 0.164, 0.19600000000000004, 0.228, 0.26, 0.29200000000000004, 0.32400000000000007, 0.3560000000000001, 0.388, 0.42], "bin_edgesXsign": 2.1, "HistogramY": [1, 2, 4, 3, 6, 2, 4, 9, 4, 9, 12, 9, 10, 7, 8, 7, 2, 1, 0, 1], "bin_edgesY": [-0.08, -0.051500000000000004, -0.023000000000000007, 0.005499999999999991, 0.03399999999999999, 0.062499999999999986, 0.09099999999999998, 0.11949999999999998, 0.14799999999999996, 0.17649999999999993, 0.20499999999999996, 0.23349999999999999, 0.26199999999999996, 0.2904999999999999, 0.31899999999999995, 0.3475, 0.37599999999999995, 0.4044999999999999, 0.4329999999999999, 0.46149999999999997, 0.49], "bin_edgesYsign": 4.305, "HistogramZ": [1, 0, 1, 1, 1, 4, 0, 4, 12, 16, 17, 15, 17, 3, 2, 3, 1, 2, 0, 1], "bin_edgesZ": [-0.34, -0.3105, -0.281, -0.2515, -0.222, -0.1925, -0.16299999999999998, -0.13349999999999998, -0.10399999999999998, -0.07449999999999996, -0.044999999999999984, -0.015499999999999958, 0.014000000000000068, 0.04350000000000004, 0.07300000000000006, 0.10250000000000004, 0.13200000000000006, 0.16150000000000003, 0.19100000000000011, 0.22050000000000008, 0.25], "bin_edgesZsign": -0.9449999999999996, "telematicsData": []}, "prediction": {"predicted_label": "harshLeftTurn", "score": [24.52, 27.57, 27.729999999999993], "top_labels": ["harshLeftTurn", "harshLeftTurn", "harshLeftTurn"], "isPotentialAlert": false, "collisionValue": null, "collisionThreshold": 2.5, "uuids": ["66ad74e1-8241-4f53-819a-1749bbff4496", "c0bf2740-1bca-4052-a250-cd4525562f3c", "314ce5ff-60fc-462c-b0bc-82d273152967"], "threshold": 25.0}}, "OutputSQSQueueName": "pvcam-prod-BlackboxOutputQueue", "ModelInfo": {"ClassifierGroupId": "imu", "ClassifierIds": ["5af24700-c598-493c-ac98-f0880777e612"], "ClassifierId": "5af24700-c598-493c-ac98-f0880777e612", "arn": "arn:aws:states:us-east-1:846444612901:stateMachine:pvcam-prod-IMUModelStateMachine"}, "timezone_metadata": [{"attribute_name": "timeStamp", "UTC_timestamp": "2022-11-29T19:44:33.551Z", "local_timestamp": "2022-11-29T19:44:33.551", "timezone_offset": "+00:00", "dst_offset": "+00:00"}], "OutputSQSQueueUrl": "https://queue.amazonaws.com/846444612901/pvcam-prod-BlackboxOutputQueue", "RequestId": "202249a1-5d85-43fb-95c8-c91d15b1f5d3"}'}
        self.overall_mean_value_1 = 0.2
        self.final_top_3_result_impact_rate_1 = 0.4
        self.overall_mean_value_2 = 0.2
        self.final_top_3_result_impact_rate_2 = 0.5
        self.new_comfirmed_class = 'bump'
        self.version = 'v5'

    def test_add2_versions_of_add_template_performance_of_v1(self):
        add_template_performance_of_v1(self.overall_mean_value_1,
                                       self.final_top_3_result_impact_rate_1,
                                       self.overall_mean_value_2,
                                       self.final_top_3_result_impact_rate_2,
                                       self.potential_event,
                                       self.new_comfirmed_class,
                                       self.version)

        add_template_performance_of_v1(self.overall_mean_value_1,
                                       self.final_top_3_result_impact_rate_1,
                                       self.overall_mean_value_2,
                                       self.final_top_3_result_impact_rate_2,
                                       self.potential_event,
                                       self.new_comfirmed_class,
                                       'v6')
        result_1 = self.potential_event['Template_performance_v1']['v5']['template_final_result']['template_evaluation_v1']
        expect_1 = 'bad template'
        result_2 = self.potential_event['Template_performance_v1']['v6']['template_final_result']['template_evaluation_v1']
        expect_2 = 'bad template'
        self.assertEqual(result_1, expect_1)
        self.assertEqual(result_2, expect_2)



class Test_new_top3_and_final_result_of_every_event(unittest.TestCase):
    def setUp(self):
        self.event = {'matching_score_list': {'harshBraking_1': 1,
                                              'harshBraking_2': 3,
                                              'harshRightTurn_3': 2,
                                              'harshRightTurn_4': 2, },
                      'matching_score_list_with_potential_template': {'harshBraking_3': 1,
                                                                      'harshBraking_4': 0.2,
                                                                      'harshRightTurn_5': 0.3,
                                                                      'harshRightTurn_6': 0.5,}}
        self.version = 'v5'
        self.potential_templates_group_keys_1 = ['harshRightTurn_6','harshRightTurn_5']
        self.potential_templates_group_keys_2 = ['harshRightTurn_6', 'harshBraking_4']

    def test_add2_versions_of_new_top3_and_final_result_of_every_event(self):

        new_top3_and_final_result_of_every_event(self.event,self.version,self.potential_templates_group_keys_1)
        new_top3_and_final_result_of_every_event(self.event, 'v7', self.potential_templates_group_keys_2)

        result_1 = self.event['new_predict_result_before_rules_valid_2']['v5']['new_final_result']
        expect_1 = 'harshRightTurn'
        result_2 = self.event['new_predict_result_before_rules_valid_2']['v5']['new_top_3']['harshRightTurn_6']
        expect_2 = 0.5
        result_3 = self.event['new_predict_result_before_rules_valid_2']['v7']['new_final_result']
        expect_3 = 'harshBraking'
        result_4 = self.event['new_predict_result_before_rules_valid_2']['v7']['new_top_3']['harshRightTurn_6']
        expect_4 = 0.5
        self.assertEqual(result_1, expect_1)
        self.assertEqual(result_2, expect_2)
        self.assertEqual(result_3, expect_3)
        self.assertEqual(result_4, expect_4)
        print(self.event)

class Test_influenced_value_of_validation_2(unittest.TestCase):
    def setUp(self):
        self.event = [{'matching_score_list': {'harshBraking_1': 1,
                                                 'harshBraking_2': 3,
                                                 'harshRightTurn_3': 2,
                                                 'harshRightTurn_4': 2},
                         'matching_score_list_with_potential_template': {'harshBraking_3': 1,
                                                                         'harshBraking_4': 0.2,
                                                                         'harshRightTurn_5': 0.3,
                                                                         'harshRightTurn_6': 0.5},
                         'new_predict_result_before_rules_valid_2': {'v5': {'new_top_3': {'harshRightTurn_5': 0.3,
                                                                                          'harshRightTurn_6': 0.5,
                                                                                          'harshBraking_1': 1},
                                                                            'new_final_result': 'harshRightTurn'}},
                      'Correct Classification':'Right'}]

        self.potential_template_key = 'harshRightTurn_6'
        self.version = 'v5'

    def test_influenced_value_of_validation_2(self):
        influenced_events_number_result_1,influenced_correct_events_number_result_1, influenced_wrong_events_finally_number_result_1 = influenced_value_of_validation_2(self.potential_template_key,
                                                                                                                                                                        Event_category_from_daily_imu_data,
                                                                                                                                                                        self.event,
                                                                                                                                                                        0,
                                                                                                                                                                        self.version)
        expect_1 = 0
        expect_2 = 0
        expect_3 = 0
        self.assertEqual(influenced_events_number_result_1, expect_1)
        self.assertEqual(influenced_correct_events_number_result_1, expect_2)
        self.assertEqual(influenced_wrong_events_finally_number_result_1, expect_3)

    def test_influenced_value_of_validation_2_2(self):
        influenced_events_number_result_1,influenced_correct_events_number_result_1, influenced_wrong_events_finally_number_result_1 = influenced_value_of_validation_2(self.potential_template_key,
                                                                                                                                                                        Event_category_from_daily_imu_data,
                                                                                                                                                                        self.event,
                                                                                                                                                                        1,
                                                                                                                                                                        self.version)
        expect_1 = 1
        expect_2 = 1
        expect_3 = 0
        self.assertEqual(influenced_events_number_result_1, expect_1)
        self.assertEqual(influenced_correct_events_number_result_1, expect_2)
        self.assertEqual(influenced_wrong_events_finally_number_result_1, expect_3)


class Test_influenced_value_of_validation_2(unittest.TestCase):
    def setUp(self):
        self.event = [{'matching_score_list': {'harshBraking_1': 1,
                                                 'harshBraking_2': 3,
                                                 'harshRightTurn_3': 2,
                                                 'harshRightTurn_4': 2},
                         'matching_score_list_with_potential_template': {'harshBraking_3': 1,
                                                                         'harshBraking_4': 0.2,
                                                                         'harshRightTurn_5': 0.3,
                                                                         'harshRightTurn_6': 0.5},
                         'new_predict_result_before_rules_valid_2': {'v5': {'new_top_3': {'harshRightTurn_5': 0.3,
                                                                                          'harshRightTurn_6': 0.5,
                                                                                          'harshBraking_1': 1},
                                                                            'new_final_result': 'harshRightTurn'}},
                      'Correct Classification':'Right'}]

        self.potential_template_key = 'harshRightTurn_6'
        self.version = 'v5'
        self.template_data = {}

    def test_influenced_value_of_validation_2(self):
        get_key_validation_rate_v2(self.potential_template_key, Event_category_from_daily_imu_data, self.event, self.template_data, self.version)
        result_1 = self.template_data['Template_performance_v2']['v5']['template_performance_details']['correct_detected_rate_top3']
        expect_1 = 0
        result_2 = self.template_data['Template_performance_v2']['v5']['template_performance_details']['wrong_detected_rate_final']
        expect_2 = 0
        print(self.template_data)
        self.assertEqual(result_1, expect_1)
        self.assertEqual(result_2, expect_2)

class Test_judge_of_v2(unittest.TestCase):
    def setUp(self):
        self.template_data = {'Template_performance_v2': {'v5': {'template_performance_details': {'correct_detected_rate_top3': 0.0,
                                                                                                  'wrong_detected_rate_final': 0.0,
                                                                                                  'influenced_events_numbers': (0, 1, 0),
                                                                                                  'influenced_correct_events_numbers': (0, 1, 0),
                                                                                                  'influenced_wrong_events_finally_numbers': (0, 0, 0)}}}}
        self.version = 'v5'

    def test_judge_of_v2(self):
        judge_of_v2(self.template_data, self.version)
        result = self.template_data['Template_performance_v2']['v5']['template_evaluation_v2']
        expect = 'failed template'
        self.assertEqual(result, expect)

if __name__ == '__main__':
    unittest.main()
